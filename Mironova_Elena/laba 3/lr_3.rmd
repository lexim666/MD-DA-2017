---
title: "Laba 3"
author: "Миронова Елена"
date: '17 ноября 2017 г '
output: html_document
---

### Задачи для лабораторной: 
1. работа с текстом;
2. использование регулярных выражений для извлечения данных;
3. переписывание существующего кода;
4. ассиметричные распределения.

### Требования к оформлению
1. Оформить решение в R Markdown. 
2. Сохранить файл в свой репозиторий.
3. Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

### Исходные данные
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

#### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.

```{r}
 forbesD <- readLines("https://raw.githubusercontent.com/SergeyMirvoda/MD-DA-2017/master/data/forbes.htm")
```
   a) Сколько строк в файле?
```{r}
   length(forbesD) 
```
1991 строк.    
   b) Сколько символов в файле?
```{r}
  sum(nchar(forbesD)) 
```
80380 символов.    
  
2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

* Доход Билла Гейтса: 72$

* Доход Ларри Эллисона: 41$   

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.
Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.
```{r}
pattern <- "[$]\\d{,2}[,]?\\d{,2}?\\s[B]"
forbes.profit <- grep(pattern, forbesD)
length(forbes.profit) == 100
print("Строки со сведениями о доходе:")
forbesD[forbes.profit] #100 записей
```
Действительно выводится 100 записей с доходами.
4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.
Проверьте следующее:
```{r}
forbes.allprofit <- regmatches(forbesD, regexpr(pattern, forbesD)) #создание вектора доходов
```
   a) Должно быть ровно сто значений.
```{r}
length(forbes.allprofit)
```   
Так и есть. Ровно 100.   
   b) Самый большой доход должен быть доход Билла Гейтса
```{r}
forbes.allprofit[1]
```   
Получили: "$72 B"     
   c) Такой доход должен быть в списке один раз.
```{r}
length(forbes.allprofit[forbes.allprofit=="$72 B"]) #доход, как у Билла Гейтса, встречается только 1 раз
```   
Да, так и есть. Результат - число 1.    
   d) В списке должна быть цифра, которую мы запомнили для Ларри Эллисона.
```{r}
forbes.allprofit[forbes.allprofit=="$41 B"] #вывод дохода Ларри Эллисона
```   
Да, "$41 B"    
   e) Должно быть как минимум два значения, встречающихся несколько раз.  
```{r}
length(unique(forbes.allprofit)); #66/100
``` 
66 элементов из 100 являются не повторяются.      
#### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_. 
```{r}
forbes.allprofit_new<-regmatches(forbesD, regexpr(pattern,forbesD)) #извлечение совпадений
forbes.allprofit_new<-sub(",",".",forbes.allprofit_new) #замещение
forbes.allprofit_new<-substr(forbes.allprofit_new,2,nchar(forbes.allprofit_new)-2) 
worths<-as.numeric(forbes.allprofit_new)*10^9
``` 
Удостоверьтесь в следующем:
   a. worths является вектором и в нём сто значений типа double.
```{r}
is.double(worths)
``` 
Получаем значение TRUE.    
   b. Все элементы вектора _worths_ больше 1 миллиарда.
```{r}
length(worths[worths>10^9])
``` 
Т.к. в векторе 100 значений, значит и сейчас должны получить 100.
Так и есть - результат число 100.
   c. Самое большое число это доход Билла Гейтса.
```{r}
max(worths); 
``` 
Число: 7.2х10^10    
6. Используйте вектор _worths_ , чтобы выяснить следующее:
   a. Какова медиана ста этих записей?
```{r}
median(worths) 
``` 
Медиана: 8.3х10^9      
   b. Средний доход?
```{r}
mean(worths) #средний доход: 1.293*10^10
``` 
Средний доход: 1.293х10^10    
   c. Как много людей из этого списка имеют доход больше 5млрд., 10, 25?
```{r}
length(worths[worths>5*10^9])
length(worths[worths>10*10^9])
length(worths[worths>25*10^9])
``` 
Больше 5 млрд: 89 людей       
Больше 10 млрд: 39 людей     
Больше 25 млрд: 12 людей     
    d. Какой их общий доход?
```{r}
sum(worths) 
``` 
Общий доход составляет: 1.293х10^12    
   e. Какую долю от общего дохода, составляет пятёрка самых богатых.
```{r}
sum(worths[1:5])/sum(worths) 
``` 
Доля от общего дохода для пятерки самых богатых: 0.1883217    
(18%)     
   f. Какую долю от общего дохода, составляют 20 самых богатых.
```{r}
sum(worths[1:20])/sum(worths) 
``` 
Доля от общего дохода для двадцати самых богатых: 0.4921114   
(49%)      
   g. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
```{r}
household.net.worth<-92172*10^9 #доход всех домохозяйств за 2016 год составил 92172 млрд.
sum(worths)/household.net.worth #доля 100 богатейших людей от общего дохода всех домохозяйств: 0.01402812
``` 
