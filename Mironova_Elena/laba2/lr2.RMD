---
title: "Laba 2"
author: "Миронова Елена"
date: '17 ноября 2017 г '
output: html_document
---
  
### Задачи для лабораторной:
1) манипулирование объектами данных;
2) работа с циклами;
3) переписывание существующего кода;
4) моделирование при помощи генератора случайных величин.

### Требования к оформлению
1. Оформить решение в R Markdown. 
2. Сохранить файл в свой репозиторий.
3. Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

### Исходные данные
Установленная среда R включает в себя набор заранее сконфигурированных массивов данных.
В данной лабораторной требуется использовать одну из них  — датафрейм из 93 машин-новинок 1993 года.
Для того, чтобы загрузить данный датафрейм, необходимо выполнить следующие команды:
  
  ```{r}
library(MASS)
data(Cars93)
```
Для того, чтобы ознакомиться со структурой и составом данных, можно выполнить команду ``View(Cars93)`` 
или нажать на соответствующую кнопку в RStudio.

#### Задание 1
1. Выполните команду ``summary()`` на полном наборе данных. Можно ли по результату выполнения сказать сколько строк в датафрейме?
Если да, напишите сколько. Если нет, то приведите другой способ.

```{r}
summary(Cars93)
```
По выходным данным команды можно определять количество строк в датафрейме (в данном случае — 93 значения).

2. Найдите среднюю цену машин с задним приводом.

```{r}
mean(Cars93[["Price"]][Cars93[["DriveTrain"]]=="Rear"])
```
Получили число 28.95.

3. Найдите минимальное число лошадиных сил автомобиля для 7 пассажиров. Для 6 пассажиров
```{r}
min(Cars93[["Horsepower"]][Cars93[["Passengers"]]==7])
min(Cars93[["Horsepower"]][Cars93[["Passengers"]]==6])
```
Для 7- 109, для 6 - 100.

4. Найдите машины с максимальным, минимальным и средним(медианой) расстоянием, которая машина может проехать по трассе. Вам понадобятся 2 колонки, чтобы рассчитать расстояние. Какие?
```{r}
Cars93["distances"] <-c(Cars93[["MPG.highway"]]*Cars93[["Fuel.tank.capacity"]])
Cars93[Cars93[ , "distances"] == max(Cars93["distances"]), "Make"]
Cars93[Cars93[ , "distances"] == min(Cars93["distances"]), "Make"]
Cars93[Cars93[ , "distances"] == median(Cars93[["distances"]]), "Make"]
```

Для получения вектора расстояний необходимо перемножить значения колонок MPG.highway и Fuel.tank.capacity.
С максимальным расстоянием - BMW 535i.
С минимальным - Mercury Capri.
Со средним - Mazda MPV.

#### Задание 2
В самом начале занятий приводился пример с фабрикой и производством автомобилей.
Ниже приведён пример кода, который старается оптимизировать выпуск продукции ориентируясь на доступные ресурсы.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(output)
}
```
1. Выполните код и запустите эту функцию ``factory.run()``.

```
factory.run();
```

2. С каким входными значениями функция вызвана? Какой получился результат?
Функция ``factory.run()`` вызывается со стандартными значениями. Первоначально необходимо было изготовить 1 машину и 1 грузовик. В результате выполнения шагов выводятся затрачиваемые ресурсы и № шага цикла.В результате функция возвращает количество автомобилей и грузовиков, которое выгодно выпустить.     
Консоль выдала такие значения:
автомобили - 10.48683,  грузовики - 19.65756

3. Повторите вызов 4 раза. Полученные ответы отличаются от полученных ранее? Если да, почему? Если нет, почему?
```{r}
factory.run();
factory.run();
factory.run();
factory.run();
```
  
1 раз: автомобили 9.861185 грузовики 20.012262 ;    
2 раз: автомобили 10.43063 грузовики 19.67539 ;    
3 раз: автомобили 9.925438 грузовики 19.922104;     
4 раз: автомобили 10.39747 грузовики 19.69911;       
Результаты отличаются друг от друга потому, что для оптимизации выпуска продукции используются рандомные числа.


4. В приведённом коде, переменные _steps_ и _output_ находятся внутри алгоритма.
Измените функцию так, чтобы она возвращала число шагов и произведённое количество машин.
```{r}
factory.run <- function(o.cars = 1, o.trucks = 1) {
  factory <- matrix(c(40, 1, 60, 3), nrow = 2, dimnames = list(c("трудодни", "сталь"), c("автомобили", "грузовики")))
  warehouse <- c(1600, 70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8, 1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break ()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next ()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next ()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1 + runif(length(output), min = -0.1, max = 0.1))
  }
  print(needed)
  message(steps)
  return(trunc(output))
}
factory.run()
```

5. Установите план равный 30 автомобилям и 20 грузовикам и выполните функцию.
```{r}
factory.run(30, 20)
```
В результате выполнения функции получили почти такое же значение автомобилей.

#### Вывод

Вне зависимости от входных параметров будет получен один и тот же результат, наиболее близкий к оптимальному распределению ресурсов.
